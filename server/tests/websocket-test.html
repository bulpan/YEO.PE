<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YEO.PE WebSocket í…ŒìŠ¤íŠ¸</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        input, textarea, button {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            box-sizing: border-box;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        #log {
            background: #f5f5f5;
            padding: 10px;
            height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .status.connected {
            background: #d4edda;
            color: #155724;
        }
        .status.disconnected {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª YEO.PE WebSocket í…ŒìŠ¤íŠ¸</h1>
    
    <div class="section">
        <h2>ì—°ê²° ì„¤ì •</h2>
        <input type="text" id="serverUrl" placeholder="ì„œë²„ URL" value="http://localhost:3000">
        <input type="text" id="token" placeholder="JWT Token">
        <button onclick="connect()">ì—°ê²°</button>
        <button onclick="disconnect()">ì—°ê²° í•´ì œ</button>
        <div id="status" class="status disconnected">ì—°ê²° ì•ˆë¨</div>
    </div>
    
    <div class="section">
        <h2>ë°© ì°¸ì—¬</h2>
        <input type="text" id="roomId" placeholder="Room ID">
        <button onclick="joinRoom()">ë°© ì°¸ì—¬</button>
        <button onclick="leaveRoom()">ë°© ë‚˜ê°€ê¸°</button>
    </div>
    
    <div class="section">
        <h2>ë©”ì‹œì§€ ì „ì†¡</h2>
        <input type="text" id="messageRoomId" placeholder="Room ID">
        <textarea id="messageContent" placeholder="ë©”ì‹œì§€ ë‚´ìš©"></textarea>
        <button onclick="sendMessage()">ë©”ì‹œì§€ ì „ì†¡</button>
    </div>
    
    <div class="section">
        <h2>íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„°</h2>
        <input type="text" id="typingRoomId" placeholder="Room ID">
        <button onclick="startTyping()">íƒ€ì´í•‘ ì‹œì‘</button>
        <button onclick="stopTyping()">íƒ€ì´í•‘ ì¤‘ì§€</button>
    </div>
    
    <div class="section">
        <h2>ë¡œê·¸</h2>
        <div id="log"></div>
        <button onclick="clearLog()">ë¡œê·¸ ì§€ìš°ê¸°</button>
    </div>
    
    <script>
        let socket = null;
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'red' : type === 'success' ? 'green' : 'black';
            logDiv.innerHTML += `<div style="color: ${color}">[${time}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function updateStatus(connected) {
            const statusDiv = document.getElementById('status');
            if (connected) {
                statusDiv.className = 'status connected';
                statusDiv.textContent = 'âœ… ì—°ê²°ë¨';
            } else {
                statusDiv.className = 'status disconnected';
                statusDiv.textContent = 'âŒ ì—°ê²° ì•ˆë¨';
            }
        }
        
        function connect() {
            const serverUrl = document.getElementById('serverUrl').value;
            const token = document.getElementById('token').value;
            
            if (!token) {
                alert('í† í°ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            
            if (socket) {
                socket.disconnect();
            }
            
            socket = io(serverUrl, {
                auth: {
                    token: token
                },
                transports: ['websocket']
            });
            
            socket.on('connect', () => {
                log('âœ… WebSocket ì—°ê²° ì„±ê³µ: ' + socket.id, 'success');
                updateStatus(true);
            });
            
            socket.on('disconnect', (reason) => {
                log('âŒ ì—°ê²° í•´ì œ: ' + reason, 'error');
                updateStatus(false);
            });
            
            socket.on('connect_error', (error) => {
                log('âŒ ì—°ê²° ì˜¤ë¥˜: ' + error.message, 'error');
                updateStatus(false);
            });
            
            socket.on('error', (error) => {
                log('âŒ ì—ëŸ¬: ' + JSON.stringify(error), 'error');
            });
            
            // ë°© ê´€ë ¨ ì´ë²¤íŠ¸
            socket.on('room-joined', (data) => {
                log('âœ… ë°© ì°¸ì—¬: ' + JSON.stringify(data), 'success');
            });
            
            socket.on('room-left', (data) => {
                log('ğŸ‘‹ ë°© ë‚˜ê°: ' + JSON.stringify(data), 'info');
            });
            
            socket.on('user-joined', (data) => {
                log('ğŸ‘¤ ì‚¬ìš©ì ì°¸ì—¬: ' + data.nicknameMask, 'info');
            });
            
            socket.on('user-left', (data) => {
                log('ğŸ‘‹ ì‚¬ìš©ì ë‚˜ê°: ' + JSON.stringify(data), 'info');
            });
            
            // ë©”ì‹œì§€ ì´ë²¤íŠ¸
            socket.on('new-message', (data) => {
                log('ğŸ’¬ ìƒˆ ë©”ì‹œì§€: ' + data.nicknameMask + ': ' + data.content, 'success');
            });
            
            // íƒ€ì´í•‘ ì´ë²¤íŠ¸
            socket.on('typing-indicator', (data) => {
                if (data.isTyping) {
                    log('âŒ¨ï¸ ' + data.nicknameMask + ' íƒ€ì´í•‘ ì¤‘...', 'info');
                }
            });
        }
        
        function disconnect() {
            if (socket) {
                socket.disconnect();
                socket = null;
                updateStatus(false);
                log('ì—°ê²° í•´ì œë¨', 'info');
            }
        }
        
        function joinRoom() {
            const roomId = document.getElementById('roomId').value;
            if (!socket || !socket.connected) {
                alert('ë¨¼ì € ì—°ê²°í•´ì£¼ì„¸ìš”');
                return;
            }
            if (!roomId) {
                alert('Room IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            socket.emit('join-room', { roomId });
            log('ë°© ì°¸ì—¬ ìš”ì²­: ' + roomId, 'info');
        }
        
        function leaveRoom() {
            const roomId = document.getElementById('roomId').value;
            if (!socket || !socket.connected) {
                alert('ë¨¼ì € ì—°ê²°í•´ì£¼ì„¸ìš”');
                return;
            }
            if (!roomId) {
                alert('Room IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            socket.emit('leave-room', { roomId });
            log('ë°© ë‚˜ê°€ê¸° ìš”ì²­: ' + roomId, 'info');
        }
        
        function sendMessage() {
            const roomId = document.getElementById('messageRoomId').value;
            const content = document.getElementById('messageContent').value;
            if (!socket || !socket.connected) {
                alert('ë¨¼ì € ì—°ê²°í•´ì£¼ì„¸ìš”');
                return;
            }
            if (!roomId || !content) {
                alert('Room IDì™€ ë©”ì‹œì§€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            socket.emit('send-message', {
                roomId,
                type: 'text',
                content
            });
            log('ë©”ì‹œì§€ ì „ì†¡: ' + content, 'info');
            document.getElementById('messageContent').value = '';
        }
        
        function startTyping() {
            const roomId = document.getElementById('typingRoomId').value;
            if (!socket || !socket.connected) {
                alert('ë¨¼ì € ì—°ê²°í•´ì£¼ì„¸ìš”');
                return;
            }
            if (!roomId) {
                alert('Room IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            socket.emit('typing', { roomId, isTyping: true });
        }
        
        function stopTyping() {
            const roomId = document.getElementById('typingRoomId').value;
            if (!socket || !socket.connected) {
                return;
            }
            if (!roomId) {
                return;
            }
            socket.emit('typing', { roomId, isTyping: false });
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }
    </script>
</body>
</html>





