# ì‹¤ì‹œê°„ ì±„íŒ… (Real-time Chat)

## ê¸°ëŠ¥ ê°œìš”

ì‹¤ì‹œê°„ ì±„íŒ… ê¸°ëŠ¥ì€ WebSocketì„ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ì ê°„ ì‹¤ì‹œê°„ ë©”ì‹œì§€ êµí™˜ì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤. Socket.ioë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ë©°, ë°© ë‹¨ìœ„ë¡œ ë©”ì‹œì§€ë¥¼ ê·¸ë£¹í™”í•©ë‹ˆë‹¤.

### ëª©ì 

- ì‹¤ì‹œê°„ ë©”ì‹œì§€ ì „ì†¡ ë° ìˆ˜ì‹ 
- ë°© ë‹¨ìœ„ ê·¸ë£¹ ì±„íŒ…
- íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„°
- ì‹¤ì‹œê°„ ë©¤ë²„ ìƒíƒœ ì—…ë°ì´íŠ¸

### ìš°ì„ ìˆœìœ„

**ë†’ìŒ** - MVP í•µì‹¬ ê¸°ëŠ¥

---

## ì „ì œ ì¡°ê±´

### WebSocket ì—°ê²°

- ìœ íš¨í•œ JWT Access Token
- Socket.io í´ë¼ì´ì–¸íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬

### ë©”ì‹œì§€ ì „ì†¡

- ë¡œê·¸ì¸ ìƒíƒœ (ì¸ì¦ í•„ìš”)
- ë°©ì— ì°¸ì—¬ ì¤‘ì¸ ìƒíƒœ
- í™œì„± ìƒíƒœì¸ ë°© (ë§Œë£Œë˜ì§€ ì•ŠìŒ)

### ë©”ì‹œì§€ ì¡°íšŒ

- ì¸ì¦ ì„ íƒì  (ë¹„íšŒì›ë„ ì½ê¸° ê°€ëŠ¥)

---

## ê¸°ëŠ¥ë³„ ìƒì„¸ ëª…ì„¸

### 1. WebSocket ì—°ê²° ë° ì¸ì¦

#### ê¸°ëŠ¥ ì„¤ëª…

í´ë¼ì´ì–¸íŠ¸ê°€ WebSocket ì„œë²„ì— ì—°ê²°í•˜ê³  JWT í† í°ìœ¼ë¡œ ì¸ì¦í•©ë‹ˆë‹¤.

#### ì—°ê²° ì—”ë“œí¬ì¸íŠ¸

**URL**: `wss://yeop3.com/socket` (í”„ë¡œë•ì…˜)  
**í”„ë¡œí† ì½œ**: Socket.io over WebSocket

#### ì¸ì¦ ë°©ë²•

**ë°©ë²• 1: ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°**
```
wss://yeop3.com/socket?token={access_token}
```

**ë°©ë²• 2: auth ê°ì²´**
```javascript
const socket = io('wss://yeop3.com/socket', {
  auth: {
    token: accessToken
  }
});
```

#### ì—°ê²° í”Œë¡œìš°

1. **í´ë¼ì´ì–¸íŠ¸ ì—°ê²° ìš”ì²­**
   - Socket.io í´ë¼ì´ì–¸íŠ¸ê°€ ì„œë²„ì— ì—°ê²° ì‹œë„

2. **ì¸ì¦ ë¯¸ë“¤ì›¨ì–´ ì‹¤í–‰**
   - `socket.handshake.auth.token` ë˜ëŠ” `socket.handshake.query.token`ì—ì„œ í† í° ì¶”ì¶œ
   - JWT í† í° ê²€ì¦
   - ì‚¬ìš©ì ì •ë³´ ì¶”ì¶œ

3. **ì—°ê²° ì„±ê³µ/ì‹¤íŒ¨**
   - ì„±ê³µ: `connection` ì´ë²¤íŠ¸ ë°œìƒ
   - ì‹¤íŒ¨: `connect_error` ì´ë²¤íŠ¸ ë°œìƒ

#### ì˜ˆì™¸ ì²˜ë¦¬

| ì—ëŸ¬ | ìƒí™© | ì²˜ë¦¬ |
|------|------|------|
| `connect_error` | í† í° ì—†ìŒ | "ì¸ì¦ í† í°ì´ í•„ìš”í•©ë‹ˆë‹¤" |
| `connect_error` | ìœ íš¨í•˜ì§€ ì•Šì€ í† í° | "ìœ íš¨í•˜ì§€ ì•Šì€ í† í°ì…ë‹ˆë‹¤" |

#### í´ë¼ì´ì–¸íŠ¸ ì˜ˆì‹œ ì½”ë“œ

```javascript
import io from 'socket.io-client';

const socket = io('wss://yeop3.com/socket', {
  auth: {
    token: accessToken
  },
  transports: ['websocket']
});

socket.on('connect', () => {
  console.log('WebSocket ì—°ê²° ì„±ê³µ');
});

socket.on('connect_error', (error) => {
  console.error('ì—°ê²° ì˜¤ë¥˜:', error.message);
});
```

---

### 2. ë°© ì°¸ì—¬ (WebSocket)

#### ê¸°ëŠ¥ ì„¤ëª…

WebSocketì„ í†µí•´ ë°©ì— ì°¸ì—¬í•©ë‹ˆë‹¤. Socket.io Roomì— ìë™ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤.

#### ì´ë²¤íŠ¸ ëª…ì„¸

**í´ë¼ì´ì–¸íŠ¸ â†’ ì„œë²„**: `join-room`

**ìš”ì²­ ë°ì´í„°**:
```json
{
  "roomId": "550e8400-e29b-41d4-a716-446655440000"
}
```

**ì„œë²„ â†’ í´ë¼ì´ì–¸íŠ¸**: `room-joined`

**ì‘ë‹µ ë°ì´í„°**:
```json
{
  "roomId": "550e8400-e29b-41d4-a716-446655440000",
  "memberCount": 5
}
```

**ì„œë²„ â†’ ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸**: `user-joined`

**ì•Œë¦¼ ë°ì´í„°**:
```json
{
  "roomId": "550e8400-e29b-41d4-a716-446655440000",
  "userId": "660e8400-e29b-41d4-a716-446655440001",
  "nicknameMask": "ê¹€**",
  "memberCount": 6
}
```

#### ë™ì‘ ë°©ì‹

1. **í´ë¼ì´ì–¸íŠ¸ ì´ë²¤íŠ¸ ì „ì†¡**
   - `join-room` ì´ë²¤íŠ¸ì™€ `roomId` ì „ì†¡

2. **ì„œë²„ ì²˜ë¦¬**
   - ë°© ì¡´ì¬ ë° ë§Œë£Œ í™•ì¸
   - ë°ì´í„°ë² ì´ìŠ¤ì— ë°© ì°¸ì—¬ ì²˜ë¦¬ (ì´ë¯¸ ì°¸ì—¬ ì¤‘ì´ ì•„ë‹Œ ê²½ìš°)
   - Socket.io Roomì— ì†Œì¼“ ì¶”ê°€ (`socket.join(room:${roomId})`)

3. **ì‘ë‹µ ì „ì†¡**
   - ë³¸ì¸ì—ê²Œ `room-joined` ì´ë²¤íŠ¸ ì „ì†¡
   - ë‹¤ë¥¸ ë©¤ë²„ë“¤ì—ê²Œ `user-joined` ì´ë²¤íŠ¸ ì „ì†¡ (ìƒˆë¡œ ì°¸ì—¬í•œ ê²½ìš°)

#### ì˜ˆì™¸ ì²˜ë¦¬

| ì—ëŸ¬ ì´ë²¤íŠ¸ | ìƒí™© | ì‘ë‹µ |
|------------|------|------|
| `error` | roomId ì—†ìŒ | `{ message: "roomIdê°€ í•„ìš”í•©ë‹ˆë‹¤" }` |
| `error` | ë°© ì—†ìŒ | `{ message: "ë°©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤" }` |
| `error` | ë§Œë£Œëœ ë°© | `{ message: "ë§Œë£Œëœ ë°©ì…ë‹ˆë‹¤" }` |

#### í´ë¼ì´ì–¸íŠ¸ ì˜ˆì‹œ ì½”ë“œ

```javascript
socket.emit('join-room', {
  roomId: '550e8400-e29b-41d4-a716-446655440000'
});

socket.on('room-joined', (data) => {
  console.log('ë°© ì°¸ì—¬ ì„±ê³µ:', data);
});

socket.on('user-joined', (data) => {
  console.log('ìƒˆ ë©¤ë²„ ì°¸ì—¬:', data);
});
```

---

### 3. ë°© ë‚˜ê°€ê¸° (WebSocket)

#### ê¸°ëŠ¥ ì„¤ëª…

WebSocketì„ í†µí•´ ë°©ì—ì„œ ë‚˜ê°‘ë‹ˆë‹¤. Socket.io Roomì—ì„œ ìë™ìœ¼ë¡œ ì œê±°ë©ë‹ˆë‹¤.

#### ì´ë²¤íŠ¸ ëª…ì„¸

**í´ë¼ì´ì–¸íŠ¸ â†’ ì„œë²„**: `leave-room`

**ìš”ì²­ ë°ì´í„°**:
```json
{
  "roomId": "550e8400-e29b-41d4-a716-446655440000"
}
```

**ì„œë²„ â†’ í´ë¼ì´ì–¸íŠ¸**: `room-left`

**ì‘ë‹µ ë°ì´í„°**:
```json
{
  "roomId": "550e8400-e29b-41d4-a716-446655440000"
}
```

**ì„œë²„ â†’ ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸**: `user-left`

**ì•Œë¦¼ ë°ì´í„°**:
```json
{
  "roomId": "550e8400-e29b-41d4-a716-446655440000",
  "userId": "660e8400-e29b-41d4-a716-446655440001",
  "memberCount": 4
}
```

#### ë™ì‘ ë°©ì‹

1. **í´ë¼ì´ì–¸íŠ¸ ì´ë²¤íŠ¸ ì „ì†¡**
   - `leave-room` ì´ë²¤íŠ¸ì™€ `roomId` ì „ì†¡

2. **ì„œë²„ ì²˜ë¦¬**
   - ë°ì´í„°ë² ì´ìŠ¤ì— ë°© ë‚˜ê°€ê¸° ì²˜ë¦¬
   - Socket.io Roomì—ì„œ ì†Œì¼“ ì œê±° (`socket.leave(room:${roomId})`)

3. **ì‘ë‹µ ì „ì†¡**
   - ë³¸ì¸ì—ê²Œ `room-left` ì´ë²¤íŠ¸ ì „ì†¡
   - ë‹¤ë¥¸ ë©¤ë²„ë“¤ì—ê²Œ `user-left` ì´ë²¤íŠ¸ ì „ì†¡

#### ì˜ˆì™¸ ì²˜ë¦¬

| ì—ëŸ¬ ì´ë²¤íŠ¸ | ìƒí™© | ì‘ë‹µ |
|------------|------|------|
| `error` | roomId ì—†ìŒ | `{ message: "roomIdê°€ í•„ìš”í•©ë‹ˆë‹¤" }` |
| `error` | ë°© ì—†ìŒ | `{ message: "ë°©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤" }` |
| `error` | ì°¸ì—¬ ì¤‘ì´ ì•„ë‹˜ | `{ message: "ì°¸ì—¬ ì¤‘ì¸ ë°©ì´ ì•„ë‹™ë‹ˆë‹¤" }` |

---

### 4. ë©”ì‹œì§€ ì „ì†¡ (WebSocket)

#### ê¸°ëŠ¥ ì„¤ëª…

WebSocketì„ í†µí•´ ì‹¤ì‹œê°„ìœ¼ë¡œ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤. ê°™ì€ ë°©ì˜ ëª¨ë“  ë©¤ë²„ì—ê²Œ ì¦‰ì‹œ ì „ë‹¬ë©ë‹ˆë‹¤.

#### ì´ë²¤íŠ¸ ëª…ì„¸

**í´ë¼ì´ì–¸íŠ¸ â†’ ì„œë²„**: `send-message`

**ìš”ì²­ ë°ì´í„°**:
```json
{
  "roomId": "550e8400-e29b-41d4-a716-446655440000",
  "type": "text",
  "content": "ì•ˆë…•í•˜ì„¸ìš”!"
}
```

**ì´ë¯¸ì§€ ë©”ì‹œì§€**:
```json
{
  "roomId": "550e8400-e29b-41d4-a716-446655440000",
  "type": "image",
  "imageUrl": "https://objectstorage.../image.jpg"
}
```

**ì„œë²„ â†’ ëª¨ë“  í´ë¼ì´ì–¸íŠ¸**: `new-message`

**ì‘ë‹µ ë°ì´í„°**:
```json
{
  "messageId": "770e8400-e29b-41d4-a716-446655440003",
  "roomId": "550e8400-e29b-41d4-a716-446655440000",
  "userId": "660e8400-e29b-41d4-a716-446655440001",
  "nicknameMask": "ê¹€**",
  "type": "text",
  "content": "ì•ˆë…•í•˜ì„¸ìš”!",
  "imageUrl": null,
  "createdAt": "2024-01-01T12:00:00.000Z"
}
```

#### ë™ì‘ ë°©ì‹

1. **í´ë¼ì´ì–¸íŠ¸ ì´ë²¤íŠ¸ ì „ì†¡**
   - `send-message` ì´ë²¤íŠ¸ì™€ ë©”ì‹œì§€ ë°ì´í„° ì „ì†¡

2. **ì„œë²„ ê²€ì¦**
   - ë°© ì¡´ì¬ ë° ë§Œë£Œ í™•ì¸
   - ì‚¬ìš©ìê°€ ë°©ì— ì°¸ì—¬ ì¤‘ì¸ì§€ í™•ì¸
   - ë©”ì‹œì§€ íƒ€ì… ê²€ì¦ (text, image, emoji)
   - í…ìŠ¤íŠ¸ ë©”ì‹œì§€ ê¸¸ì´ ê²€ì¦ (ìµœëŒ€ 1000ì)

3. **ë©”ì‹œì§€ ì €ì¥**
   - ë°ì´í„°ë² ì´ìŠ¤ì— ë©”ì‹œì§€ ì €ì¥
   - ë§Œë£Œ ì‹œê°„ ì„¤ì • (ë°©ê³¼ ë™ì¼í•˜ê²Œ 24ì‹œê°„)

4. **ë¸Œë¡œë“œìºìŠ¤íŠ¸**
   - ê°™ì€ ë°©ì˜ ëª¨ë“  ë©¤ë²„ì—ê²Œ `new-message` ì´ë²¤íŠ¸ ì „ì†¡
   - `io.to(room:${roomId}).emit('new-message', data)`

#### ì˜ˆì™¸ ì²˜ë¦¬

| ì—ëŸ¬ ì´ë²¤íŠ¸ | ìƒí™© | ì‘ë‹µ |
|------------|------|------|
| `error` | roomId ì—†ìŒ | `{ message: "roomIdê°€ í•„ìš”í•©ë‹ˆë‹¤" }` |
| `error` | ë°© ì—†ìŒ | `{ message: "ë°©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤" }` |
| `error` | ë§Œë£Œëœ ë°© | `{ message: "ë§Œë£Œëœ ë°©ì…ë‹ˆë‹¤" }` |
| `error` | ì°¸ì—¬ ì¤‘ì´ ì•„ë‹˜ | `{ message: "ë°©ì— ì°¸ì—¬ ì¤‘ì´ ì•„ë‹™ë‹ˆë‹¤" }` |
| `error` | ìœ íš¨í•˜ì§€ ì•Šì€ íƒ€ì… | `{ message: "ìœ íš¨í•˜ì§€ ì•Šì€ ë©”ì‹œì§€ íƒ€ì…ì…ë‹ˆë‹¤" }` |
| `error` | ë©”ì‹œì§€ ë‚´ìš© ì—†ìŒ | `{ message: "ë©”ì‹œì§€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" }` |
| `error` | ë©”ì‹œì§€ ê¸¸ì´ ì´ˆê³¼ | `{ message: "ë©”ì‹œì§€ëŠ” 1000ì ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤" }` |

#### í´ë¼ì´ì–¸íŠ¸ ì˜ˆì‹œ ì½”ë“œ

```javascript
socket.emit('send-message', {
  roomId: '550e8400-e29b-41d4-a716-446655440000',
  type: 'text',
  content: 'ì•ˆë…•í•˜ì„¸ìš”!'
});

socket.on('new-message', (message) => {
  console.log('ìƒˆ ë©”ì‹œì§€:', message);
  // UIì— ë©”ì‹œì§€ ì¶”ê°€
});
```

---

### 5. íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„°

#### ê¸°ëŠ¥ ì„¤ëª…

ì‚¬ìš©ìê°€ ë©”ì‹œì§€ë¥¼ ì…ë ¥ ì¤‘ì¼ ë•Œ ë‹¤ë¥¸ ë©¤ë²„ë“¤ì—ê²Œ ì•Œë¦½ë‹ˆë‹¤.

#### ì´ë²¤íŠ¸ ëª…ì„¸

**í´ë¼ì´ì–¸íŠ¸ â†’ ì„œë²„**: `typing`

**ìš”ì²­ ë°ì´í„°**:
```json
{
  "roomId": "550e8400-e29b-41d4-a716-446655440000",
  "isTyping": true
}
```

**ì„œë²„ â†’ ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸**: `typing-indicator`

**ì•Œë¦¼ ë°ì´í„°**:
```json
{
  "roomId": "550e8400-e29b-41d4-a716-446655440000",
  "userId": "660e8400-e29b-41d4-a716-446655440001",
  "nicknameMask": "ê¹€**",
  "isTyping": true
}
```

#### ë™ì‘ ë°©ì‹

1. **í´ë¼ì´ì–¸íŠ¸ ì´ë²¤íŠ¸ ì „ì†¡**
   - ì‚¬ìš©ìê°€ ì…ë ¥ ì‹œì‘: `isTyping: true`
   - ì‚¬ìš©ìê°€ ì…ë ¥ ì¤‘ì§€: `isTyping: false`

2. **ì„œë²„ ë¸Œë¡œë“œìºìŠ¤íŠ¸**
   - ê°™ì€ ë°©ì˜ ë‹¤ë¥¸ ë©¤ë²„ë“¤ì—ê²Œë§Œ ì „ì†¡ (ë³¸ì¸ ì œì™¸)
   - `socket.to(room:${roomId}).emit('typing-indicator', data)`

#### í´ë¼ì´ì–¸íŠ¸ ì˜ˆì‹œ ì½”ë“œ

```javascript
let typingTimeout;

inputElement.addEventListener('input', () => {
  socket.emit('typing', {
    roomId: currentRoomId,
    isTyping: true
  });

  clearTimeout(typingTimeout);
  typingTimeout = setTimeout(() => {
    socket.emit('typing', {
      roomId: currentRoomId,
      isTyping: false
    });
  }, 3000); // 3ì´ˆ í›„ ìë™ìœ¼ë¡œ false
});

socket.on('typing-indicator', (data) => {
  if (data.isTyping) {
    showTypingIndicator(data.nicknameMask);
  } else {
    hideTypingIndicator(data.userId);
  }
});
```

---

### 6. ë©”ì‹œì§€ ëª©ë¡ ì¡°íšŒ (REST API)

#### ê¸°ëŠ¥ ì„¤ëª…

REST APIë¥¼ í†µí•´ ë°©ì˜ ë©”ì‹œì§€ ëª©ë¡ì„ ì¡°íšŒí•©ë‹ˆë‹¤. ë¹„íšŒì›ë„ ì½ê¸° ê°€ëŠ¥í•©ë‹ˆë‹¤.

#### API ëª…ì„¸

**ì—”ë“œí¬ì¸íŠ¸**: `GET /api/rooms/:roomId/messages`

**ì¸ì¦**: ì„ íƒì  (ë¹„íšŒì›ë„ ì ‘ê·¼ ê°€ëŠ¥)

**ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°**:
- `limit`: ì¡°íšŒí•  ë©”ì‹œì§€ ê°œìˆ˜ (ê¸°ë³¸ê°’: 50, ìµœëŒ€: 100)
- `before`: í˜ì´ì§•ì„ ìœ„í•œ ë©”ì‹œì§€ ID (ì„ íƒ)

**ìš”ì²­ ì˜ˆì‹œ**:
```
GET /api/rooms/550e8400-e29b-41d4-a716-446655440000/messages?limit=50
```

**ì‘ë‹µ** (200 OK):
```json
{
  "messages": [
    {
      "messageId": "770e8400-e29b-41d4-a716-446655440003",
      "userId": "660e8400-e29b-41d4-a716-446655440001",
      "nickname": "ê¹€ì² ìˆ˜",
      "nicknameMask": "ê¹€**",
      "type": "text",
      "content": "ì•ˆë…•í•˜ì„¸ìš”!",
      "imageUrl": null,
      "createdAt": "2024-01-01T12:00:00.000Z"
    }
  ],
  "hasMore": true
}
```

#### ë™ì‘ ë°©ì‹

1. **ë°© í™•ì¸**
   - ë°© ì¡´ì¬ ì—¬ë¶€ í™•ì¸

2. **ë©”ì‹œì§€ ì¡°íšŒ**
   - `is_deleted = false`ì¸ ë©”ì‹œì§€ë§Œ ì¡°íšŒ
   - `before` íŒŒë¼ë¯¸í„°ë¡œ í˜ì´ì§• (ìˆëŠ” ê²½ìš°)
   - ìƒì„±ì¼ ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
   - ìµœì‹  ë©”ì‹œì§€ê°€ ë¨¼ì € ì˜¤ë„ë¡ ì—­ìˆœ ì •ë ¬

3. **ì‘ë‹µ ë°˜í™˜**
   - ë©”ì‹œì§€ ëª©ë¡ ë° `hasMore` í”Œë˜ê·¸ ë°˜í™˜

#### ì˜ˆì™¸ ì²˜ë¦¬

| ì—ëŸ¬ ì½”ë“œ | ìƒí™© | ì‘ë‹µ ë©”ì‹œì§€ |
|----------|------|------------|
| 404 | ë°© ì—†ìŒ | "ë°©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤" |
| 400 | limit ì´ˆê³¼ | "limitì€ 100ì„ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤" |

---

### 7. ë©”ì‹œì§€ ì‚­ì œ (REST API)

#### ê¸°ëŠ¥ ì„¤ëª…

ë³¸ì¸ì´ ì‘ì„±í•œ ë©”ì‹œì§€ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤. ì†Œí”„íŠ¸ ì‚­ì œ ë°©ì‹ì…ë‹ˆë‹¤.

#### API ëª…ì„¸

**ì—”ë“œí¬ì¸íŠ¸**: `DELETE /api/messages/:messageId`

**ì¸ì¦**: í•„ìš” (Access Token)

**ê²½ë¡œ íŒŒë¼ë¯¸í„°**:
- `messageId`: ë©”ì‹œì§€ ID (UUID)

**ìš”ì²­ í—¤ë”**:
```
Authorization: Bearer {access_token}
```

**ì‘ë‹µ** (200 OK):
```json
{
  "success": true
}
```

#### ë™ì‘ ë°©ì‹

1. **ì¸ì¦ í™•ì¸**
   - Access Token ê²€ì¦
   - ì‚¬ìš©ì ID ì¶”ì¶œ

2. **ë©”ì‹œì§€ í™•ì¸**
   - ë©”ì‹œì§€ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
   - ë³¸ì¸ ë©”ì‹œì§€ì¸ì§€ í™•ì¸

3. **ì†Œí”„íŠ¸ ì‚­ì œ**
   - `is_deleted` í•„ë“œë¥¼ `true`ë¡œ ì—…ë°ì´íŠ¸
   - ì‹¤ì œ ë°ì´í„°ëŠ” ì‚­ì œí•˜ì§€ ì•ŠìŒ (TTL ì •ë¦¬ ì‹œ ì‚­ì œ)

4. **ì‘ë‹µ ë°˜í™˜**
   - ì‚­ì œ ì„±ê³µ ì‘ë‹µ

#### ì˜ˆì™¸ ì²˜ë¦¬

| ì—ëŸ¬ ì½”ë“œ | ìƒí™© | ì‘ë‹µ ë©”ì‹œì§€ |
|----------|------|------------|
| 401 | ì¸ì¦ ì‹¤íŒ¨ | "ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤" |
| 404 | ë©”ì‹œì§€ ì—†ìŒ | "ë©”ì‹œì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤" |
| 403 | ë³¸ì¸ ë©”ì‹œì§€ ì•„ë‹˜ | "ë³¸ì¸ì˜ ë©”ì‹œì§€ë§Œ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤" |

---

## ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨

### WebSocket ì—°ê²° ë° ë©”ì‹œì§€ ì „ì†¡ í”Œë¡œìš°

```mermaid
sequenceDiagram
    participant Client1
    participant Server
    participant DB
    participant Client2

    Client1->>Server: WebSocket ì—°ê²° (JWT í† í°)
    Server->>Server: í† í° ê²€ì¦
    Server-->>Client1: connection ì´ë²¤íŠ¸

    Client1->>Server: join-room
    Server->>DB: ë°© ì°¸ì—¬ ì²˜ë¦¬
    Server-->>Client1: room-joined
    Server-->>Client2: user-joined

    Client1->>Server: send-message
    Server->>DB: ë©”ì‹œì§€ ì €ì¥
    Server->>Server: ê°™ì€ ë°© ë©¤ë²„ì—ê²Œ ë¸Œë¡œë“œìºìŠ¤íŠ¸
    Server-->>Client1: new-message
    Server-->>Client2: new-message
```

### íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° í”Œë¡œìš°

```mermaid
sequenceDiagram
    participant Client1
    participant Server
    participant Client2

    Client1->>Server: typing (isTyping: true)
    Server->>Server: ê°™ì€ ë°©ì˜ ë‹¤ë¥¸ ë©¤ë²„ì—ê²Œë§Œ ì „ì†¡
    Server-->>Client2: typing-indicator

    Note over Client1: 3ì´ˆ í›„ ìë™ìœ¼ë¡œ false
    Client1->>Server: typing (isTyping: false)
    Server-->>Client2: typing-indicator (isTyping: false)
```

---

## ìƒíƒœ ë‹¤ì´ì–´ê·¸ë¨

### WebSocket ì—°ê²° ìƒíƒœ

```mermaid
stateDiagram-v2
    [*] --> ì—°ê²°ì¤‘: ì—°ê²° ì‹œë„
    ì—°ê²°ì¤‘ --> ì—°ê²°ë¨: ì¸ì¦ ì„±ê³µ
    ì—°ê²°ì¤‘ --> ì—°ê²°ì‹¤íŒ¨: ì¸ì¦ ì‹¤íŒ¨
    ì—°ê²°ë¨ --> ë°©ì°¸ì—¬ì¤‘: join-room
    ë°©ì°¸ì—¬ì¤‘ --> ì—°ê²°ë¨: leave-room
    ì—°ê²°ë¨ --> ì—°ê²°ëŠê¹€: disconnect
    ì—°ê²°ì‹¤íŒ¨ --> [*]: ì¬ì‹œë„
    ì—°ê²°ëŠê¹€ --> [*]: ì¬ì—°ê²°
```

---

## ë©”ì‹œì§€ íƒ€ì…

### í…ìŠ¤íŠ¸ ë©”ì‹œì§€

```json
{
  "type": "text",
  "content": "ë©”ì‹œì§€ ë‚´ìš© (ìµœëŒ€ 1000ì)"
}
```

### ì´ë¯¸ì§€ ë©”ì‹œì§€

```json
{
  "type": "image",
  "imageUrl": "https://objectstorage.../image.jpg"
}
```

### ì´ëª¨ì§€ ë©”ì‹œì§€

```json
{
  "type": "emoji",
  "content": "ğŸ˜€"
}
```

---

## ì„±ëŠ¥ ê³ ë ¤ì‚¬í•­

### ë©”ì‹œì§€ ë¸Œë¡œë“œìºìŠ¤íŠ¸

- Socket.ioì˜ Room ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ íš¨ìœ¨ì ì¸ ë¸Œë¡œë“œìºìŠ¤íŠ¸
- ê°™ì€ ë°©ì˜ ë©¤ë²„ì—ê²Œë§Œ ë©”ì‹œì§€ ì „ì†¡

### í˜ì´ì§•

- ë©”ì‹œì§€ ëª©ë¡ ì¡°íšŒ ì‹œ í˜ì´ì§• ì§€ì›
- `before` íŒŒë¼ë¯¸í„°ë¡œ ì´ì „ ë©”ì‹œì§€ ì¡°íšŒ

### Rate Limiting

- ë©”ì‹œì§€ ì „ì†¡: 30íšŒ/ë¶„
- ë¬´ì°¨ë³„ ë©”ì‹œì§€ ì „ì†¡ ë°©ì§€

---

## ì°¸ê³  ìë£Œ

- [ë©”ì‹œì§€ ì„œë¹„ìŠ¤](../server/src/services/messageService.js)
- [ë©”ì‹œì§€ í•¸ë“¤ëŸ¬](../server/src/socket/messageHandler.js)
- [ë°© í•¸ë“¤ëŸ¬](../server/src/socket/roomHandler.js)
- [WebSocket í•¸ë“¤ëŸ¬](../server/src/socket/socketHandler.js)
- [ë©”ì‹œì§€ ë¼ìš°íŠ¸](../server/src/routes/messages.js)



